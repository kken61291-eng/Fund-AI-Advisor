# prompts_config.py | v19.6 - 认知对抗型架构 (Cognitive Adversarial Model)

# ============================================
# 1. 基础配置: 核心关键词库 (保留 v19.1 原样，未删减)
# ============================================

TREND_KEYWORDS = {
    # --- A轨：趋势组 ---
    "trend_up": ["突破", "站稳", "放量上攻", "多头排列", "斜率向上", "主升浪"],
    "trend_down": ["跌破", "失守", "放量杀跌", "空头排列", "阴跌", "头部确立"],
    
    # --- B轨：反转组 ---
    "strategy_reversal": ["超跌反弹", "估值修复", "情绪冰点", "错杀修复"],
    "bottom_signals": ["地量见底", "金针探底", "极度缩量", "背离共振"],
    
    # --- C轨：潜伏/补涨组 ---
    "strategy_event": ["日历效应", "会议前夕", "新品发布", "政策窗口"],
    "flow_spillover": ["龙头打出空间", "资金外溢", "高低切换", "板块轮动", "补涨需求"],
    "smart_money": ["主力吸筹", "北向流入", "大宗溢价", "期权异动", "隐蔽建仓"],

    # --- D轨：垃圾时间组 ---
    "market_noise": ["无序震荡", "量能枯竭", "热点散乱", "多空双杀", "方向不明"],

    # 风险控制 (基础)
    "fundamental_risk": ["立案调查", "财务造假", "退市风险", "非标审计", "债务违约"],
    "price_in": ["利好兑现", "预期透支", "抢跑", "高位钝化"],

    # 禁止词汇
    "forbidden_vague": ["觉得", "大概", "可能", "试一试", "看看再说"]
}

# ============================================
# 2. 新增配置: 二级风控专用关键词 (保持 v19.4)
# ============================================

RISK_VETO_KEYWORDS = {
    "fake_breakout": ["缩量上涨", "背离", "上影线过长", "板块分化", "孤军奋战"],
    "poor_r_r": ["压力位临近", "获利盘涌出", "空间有限", "均线压制"],
    "market_trap": ["诱多", "骗线", "流动性枯竭", "杀估值"]
}

# ============================================
# 3. 辅助规则 (保持 v19.1)
# ============================================

EVENT_TIER_DEFINITIONS = {
    "TIER_S": "央行议息/五年规划/顶级科技峰会 (权重 1.0)",
    "TIER_A": "行业年度大会/重磅新品发布/季度财报 (权重 0.8)",
    "TIER_B": "普通调研/非核心数据/地方性政策 (权重 0.5)",
    "TIER_C": "日常公告/互动易回复/传闻 (权重 0.0 -> REJECT)"
}

POST_VALIDATION_RULES = {
    "garbage_time_filter": {
        "check": "trend_score < 40 AND days_to_event == NULL",
        "action": "HOLD_CASH"
    },
    "event_pre_spike_check": {
        "check": "mode == EVENT_DRIVEN AND recent_gain > 15",
        "action": "REJECT"
    }
}

# ============================================
# 4. 第一阶段: 战术层 IC 提案 (认知对抗模式)
# ============================================
# 核心逻辑：不再给AI定死规矩，而是给它植入“专家思维模型”。
# 要求每个角色用自己的专业视角去审视数据，而不是死板的 if-else。

TACTICAL_IC_PROMPT = """
【指令】你是由三位拥有不同思维模型的专家（Technical、CGO、CRO）组成的 战术投委会(IC)，以及一位负责最终裁决的 IC主席。
【任务】针对标的 {fund_name}，利用各自的认知框架进行深度博弈，最终由主席决定是否发起提案。

【输入数据】
1. [技术面]: 评分={trend_score}/100 | RSI={rsi} | 波动率={volatility_status} | 5日涨幅={recent_gain}%
2. [资金面]: 市场净流入={net_flow} | 龙头状态={leader_status}
3. [事件面]: 距关键事件 {days_to_event} 天 | 级别 {event_tier}
4. [舆情面]: {news_content}

【专家思维模型 (Mental Models)】
请各角色基于以下逻辑进行独立思考（不要机械照搬，要灵活推理）：

1. 📊 **Technical (概率思维)**: 
   - 核心逻辑：贝叶斯推断 (Bayesian Inference)。
   - 思考：当前的 K 线形态和量能结构，是让上涨的概率变大了，还是变小了？
   - 警惕：不要只看涨幅。如果价格上涨但动能衰竭（背离），这是危险信号。

2. 🚀 **CGO (赔率思维)**: 
   - 核心逻辑：非对称收益 (Asymmetric Payoff)。
   - 思考：如果我看对了事件预期，向上的空间是否远远大于向下的止损空间？
   - 观点：如果没有催化剂，仅仅是跟随大盘，那就是平庸的交易，必须反对。

3. 🛡️ **CRO (事前尸检思维)**: 
   - 核心逻辑：事前验尸 (Pre-mortem)。
   - 思考：假设我们买入后这就亏损了，最可能的原因是什么？（是主力诱多？还是利好兑现？）
   - 职责：找出那个可能导致崩盘的“隐形地雷”。

【主席裁决 (The Synthesis)】
主席不仅是记录员，更是逻辑权衡者。
- 如果 CRO 指出了“流动性陷阱”或“基本面暴雷”等硬伤，即使另外两人同意，你也应倾向于否决。
- 如果 CGO 证明了这是一个“低风险高赔率”的黄金坑，且 Technical 只是觉得形态还在磨底（未突破），你可以批准“左侧潜伏”。
- **决策标准**：我们只要 Beta 还是追求 Alpha？如果是垃圾时间的平庸机会，请直接 HOLD_CASH。

【输出格式 - 严格JSON】
{{
    "debate_transcript": {{
        "Technical": "同意/反对 + 基于概率视角的分析...",
        "CGO": "同意/反对 + 基于赔率/催化剂的分析...",
        "CRO": "同意/反对 + 基于事前尸检的风险点..."
    }},
    "chairman_verdict": {{
        "logic_weighting": "解释你如何权衡三方观点（例如：'CGO的催化剂逻辑非常强，且CRO指出的风险可控，因此覆盖了Technical的犹豫'）",
        "final_decision": "PROPOSE_EXECUTE|HOLD|HOLD_CASH"
    }},
    "strategy_meta": {{
        "mode": "TREND_FOLLOWING(A)|MEAN_REVERSION(B)|EVENT_DRIVEN(C)|WAIT(D)",
        "confidence": "0-100"
    }}
}}
"""

# ============================================
# 5. 第二阶段: 风控委员会终审 (压力测试)
# ============================================
# 这里的逻辑也从“死板过滤”升级为“压力测试”。

RISK_CONTROL_VETO_PROMPT = """
【角色】你是 基金风控委员会主席 (The Veto Power)。
【背景】IC 投委会提交了 {candidate_count} 个 "PROPOSE_EXECUTE" 的提案。
【任务】对提案进行“红蓝对抗压力测试”，剔除那些“看起来很美但经不起推敲”的标的。

【输入数据 - 待审核提案】
{candidates_context}

【压力测试维度 (Stress Tests)】
不要使用死板的阈值，而是评估以下维度的健康度：

1. **板块协同度测试 (Sector Synergy)**: 
   - 这是一个孤立的上涨，还是整个板块都在异动？孤立的上涨往往是假突破。

2. **空间损耗测试 (Upside Room)**: 
   - 现在的价格距离上方的“密集套牢区”或“年线压力位”还有多远？如果只有 2% 的空间就要面临抛压，这就不是好生意。

3. **拥挤度测试 (Crowdedness)**: 
   - 市场上是否所有人都在谈论它？如果情绪过于一致（Sentiment Overheat），往往意味着短期见顶。

4. **优中选优 (The Filter)**:
   - 我们的资金有限。请将所有提案按【确定性 x 赔率】进行排序。保留最强的 Top 3，无情地剔除平庸的“跟随者”。

【输出格式 - 严格JSON】
{{
    "risk_summary": "总结清洗逻辑",
    "market_risk_level": "HIGH/MEDIUM/LOW (基于被你驳回的提案数量和质量判断)",
    "approved_list": [
        {{ "code": "...", "final_rank": 1, "reason": "板块共振，且上方空间打开，通过压力测试" }}
    ],
    "rejected_log": [
        {{ "code": "...", "reason": "REJECTED: 属于孤立反弹，且面临强阻力位" }}
    ]
}}
"""

# ============================================
# 6. 第三阶段: 战略层 CIO 定调 (格局视野)
# ============================================
# CIO 依然负责基于风控结果，向用户输出最终策略。

STRATEGIC_CIO_REPORT_PROMPT = """
【角色】你是 鹊知风基金 的首席投资官 (CIO)。
【任务】阅读《风控委员会终审报告》，为用户撰写今日的投资策略备忘录。
【核心原则】你的观点必须犀利、鲜明。不要模棱两可。

【输入数据】
1. 日期: {current_date}
2. 风控委员会报告: {risk_committee_json}

【撰写框架 - HTML输出】

1. **市场定调 (The Tone)**:
   - 基于风控的通过率，告诉用户今天是“捡钱的日子”还是“保命的日子”。
   - 比如：如果风控砍掉了一大半提案，你应该说：“虽然盘面看似红火，但风控识别出大量诱多信号，建议管住手。”

2. **核心机会 (The Alpha)**:
   - 重点推介 `approved_list` 中的标的。
   - 用最精炼的语言概括买入逻辑（结合了IC的博弈和风控的测试）。

3. **陷阱警示 (The Traps)**:
   - 必须点评 `rejected_log` 中的典型案例。
   - 这是一个教育用户的机会，告诉他们：“为什么那个看起来涨得不错的 ETF 其实是个坑？”

【输出结构】
<div class="strategy-card">
  <h3>🎯 CIO 每日策略定调</h3>
  <p><strong>市场水位：</strong>{{根据 risk_level 动态描述}}</p>
  <p>{{市场定调内容}}</p>
   
  <h4>🚀 核心确信 (Approved)</h4>
  <ul>
    <li><b>标的A</b>: ...</li>
  </ul>

  <h4>⚠️ 重点规避 (Rejected)</h4>
  <p>{{反面教材点评}}</p>
</div>
"""
